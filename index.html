<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.3/css/bootstrap.min.css" integrity="sha512-SbiR/eusphKoMVVXysTKG/7VseWii+Y3FdHrt0EpKgpToZeemhqHeZeLWLhJutz/2ut2Vw1uQEj2MbRF+TVBUA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css" integrity="sha512-gltmUwii2HfM/TdZNyAIza+GGuo72JKyMQSWdNgcnlHCQQGwKLpOa1AmAFvwxxG5WSsHg3IGlHea7PDeFuuuMw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<body>

    <main class="container">
        <h1>Veja seu voto</h1>

        <form id="consulta">
            <div class="mb-3">
                <label for="cpf" class="form-label">CPF</label>
                <input type="text" class="form-control" data-mask="999.999.999-99" id="cpf" placeholder="Digite seu CPF" />
                <small id="cpfHelp" class="form-text text-muted">Não se preocupe, seus dados ficarão seguros conosco.</small>
            </div>
            <button type="submit" class="btn btn-primary" id="consultar">Consultar</button>
        </form>

        <div class="p-1 fs-2" id="resultado"></div>

        <small style="color: white">Este site é de cunho exclusivamente humorístico e não deve ser levado a sério.</small>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js" integrity="sha512-6UofPqm0QupIL0kzS/UIzekR73/luZdC6i/kXDbWnLOJoqwklBK6519iUnShaYceJ0y4FaiPtX/hRnV/X/xlUQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.3/js/bootstrap.bundle.min.js" integrity="sha512-i9cEfJwUwViEPFKdC1enz4ZRGBj8YQo6QByFTF92YXHi7waCqyexvRD75S5NVTsSiTv7rKWqG9Y5eFxmRsOn0A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/js/jasny-bootstrap.min.js" integrity="sha512-RWRwS9T9ZDNcknBIfG4eojyXvNzOmsMW4g7hIRxqtpc0lfrjt2p9LNDL/23yeDgpM0qmK0FZLV66ECjVmgaLdg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha3/0.8.0/sha3.min.js" integrity="sha512-PmGDkK2UHGzTUfkFGcJ8YSrD/swUXekcca+1wWlrwALIZho9JX+3ddaaI9wmmf8PmgDIpMtx6TU8YBJAZS0mPQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script type="text/javascript">
        function validarCPF(cpf) {
            // https://www.geradorcpf.com/javascript-validar-cpf.htm
            cpf = cpf.replace(/[^\d]+/g,'');
            if (cpf == '') return false;
            // Elimina CPFs invalidos conhecidos
            if (cpf.length != 11 ||
                cpf == "00000000000" ||
                cpf == "11111111111" ||
                cpf == "22222222222" ||
                cpf == "33333333333" ||
                cpf == "44444444444" ||
                cpf == "55555555555" ||
                cpf == "66666666666" ||
                cpf == "77777777777" ||
                cpf == "88888888888" ||
                cpf == "99999999999")
                    return false;
            // Valida 1o digito
            var add = 0;
            for (i=0; i < 9; i ++)
                add += parseInt(cpf.charAt(i)) * (10 - i);
            var rev = 11 - (add % 11);
            if (rev == 10 || rev == 11)
                rev = 0;
            if (rev != parseInt(cpf.charAt(9)))
                return false;
            // Valida 2o digito
            add = 0;
            for (i = 0; i < 10; i ++)
                add += parseInt(cpf.charAt(i)) * (11 - i);
            rev = 11 - (add % 11);
            if (rev == 10 || rev == 11)
                rev = 0;
            if (rev != parseInt(cpf.charAt(10)))
                return false;
            return true;
        }

        function geraVoto(cpf) {
            console.log('cpf', cpf);

            let hash = sha3_224(cpf);
            console.log('hash', hash);

            let magicNumber = parseInt(hash.charAt(0), 16);
            console.log('magic number', magicNumber);

            // par para par, ímpar para ímpar
            let voto = (magicNumber % 2 == 0) ? 22 : 13;
            console.log('voto', voto);

            return voto;
        }

        $(function() {
            $('.inputmask').inputmask();
            $('#consulta').submit(function(event) {
                let cpf = $('#cpf').val();
                if (validarCPF(cpf)) {
                    $('#resultado').text('Você votou ' + geraVoto(cpf));
                }
                else {
                    $('#resultado').text('CPF inválido');
                }
                event.preventDefault();
            });
        });
    </script>
</body>
</html>
